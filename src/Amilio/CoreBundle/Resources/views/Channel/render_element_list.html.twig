{% if not listname is defined %}
	{% set listname = "elementlist" %}
{% endif %}

{% if channel is defined %}
	{% set elements = channel.elements %}
{% endif %} 

<div id="{{ listname }}" class="elementlist">
    
    {% for element in elements %}
        {% render(controller("AmilioCoreBundle:Channel:showElement", { "element": element.id })) %}
    {% endfor %}

    <div id="modalDialog" style="display: none; background-color: white; width: 500px; border: 1px solid #000; padding: 30px; position: relative; top: -300px">
    	<div style="text-align: right; font-size: 12px"><a href="javascript:$.modal.close()">Fenster schlie&szlig;en</a></div>
	<div id="modalDialogContent">
	</div>
    </div>
    
</div>

    <script type="text/javascript">
        var $container = $('#{{ listname }}');
        // init
        $container.isotope({
          // options
          itemSelector: '.item',
          layoutMode: 'masonry'
        });

        var elementToRemove;
        
        function confirmElementRemove(id)
        {
            elementToRemove = id;
            confirm(function(){
                var url = "{{ path('amilio_core_product_remove', { "element": "elementId"} ) }}";
                url = url.replace("elementId", elementToRemove);
            	$.post(url, function( data ) {
            		  location.reload();
            	});
            });
        }

        var oldUrl;
	var newUrl;

      function showModal(url, width)
      {
	  newUrl = url;

          if (width) {
                $("#modalDialog").width(width);
          }
          $.get( url, function( data ) {
		  $.modal.close();
                  oldUrl = window.location.href;
		  $("#modalDialog").modal({ opacity:80, overlayCss: {backgroundColor:"#000"}, onClose: function(){window.history.pushState('', '', oldUrl); $.modal.close();} });
                  $("#modalDialogContent").html( data );
		  processUserFields();
		  window.history.pushState('', '', newUrl);
          });
      }

      function showProductModal(id, name)
      {
          var url = '{{ path("amilio_core_product_show", {'product': 'elementid', 'canonicalName': 'canonicalname' })  }}';
          url = url.replace("elementid", id);
          url = url.replace("canonicalname", name);

          showModal(url, "800px");
      }        
    </script>
